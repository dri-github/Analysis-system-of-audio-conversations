# üéµ Audio Processing Application

–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤.

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –ø–æ–º–æ—â—å—é `asyncio`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–ø–∫–∏ —Å –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞–º–∏
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º API —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
- ‚úÖ FastAPI –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ Graceful shutdown
- ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.8+
- pip –∏–ª–∏ poetry

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/yourusername/audio-processing.git
cd audio-processing

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞–∫ –ø–∞–∫–µ—Ç –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
pip install -e .

# –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞–ø—Ä—è–º—É—é
pip install -r requirements.txt
```

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp .env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env —Ñ–∞–π–ª
nano .env
```

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
```env
LOGIN=your_username
PASSWORD=your_password
TRANSCRIPTION_SERVICE_URL=https://demo.connect2ai.net/spr/stt/big
```

### 3. –ó–∞–ø—É—Å–∫

```bash
# –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞)
python main.py

# –° FastAPI –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
python main.py --api

# –° —É–∫–∞–∑–∞–Ω–∏–µ–º —É—Ä–æ–≤–Ω—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
python main.py --api --log-level DEBUG
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
audio-processing/
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ settings.py          # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Pydantic)
‚îÇ   ‚îî‚îÄ‚îÄ logging_config.py    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ application.py   # –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ exceptions.py    # –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ task_pool.py     # –ü—É–ª async –∑–∞–¥–∞—á (–±—ã–≤—à–∏–π worker_pool)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transcription_service.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api_client.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ file_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ monitoring/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ watcher.py       # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–∞–ø–æ–∫
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ metrics.py       # –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îú‚îÄ‚îÄ main.py          # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ       ‚îî‚îÄ‚îÄ routes/
‚îÇ           ‚îî‚îÄ‚îÄ __init__.py  # API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îú‚îÄ‚îÄ storage/
‚îÇ   ‚îú‚îÄ‚îÄ audio_uploads/       # –í—Ö–æ–¥—è—â–∏–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ processing/          # –§–∞–π–ª—ã –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ
‚îÇ   ‚îú‚îÄ‚îÄ processed/           # –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îî‚îÄ‚îÄ json_output/         # JSON —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
‚îú‚îÄ‚îÄ tests/                   # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ main.py                  # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ pyproject.toml           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ requirements.txt         # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ README.md

```

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞

```bash
# –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫
python main.py

# –° –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –Ω–∞ –ø–æ—Ä—Ç—É 8000
python main.py --api

# Debug —Ä–µ–∂–∏–º
python main.py --api --log-level DEBUG
```

### –í–µ–± API

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å —Ñ–ª–∞–≥–æ–º `--api`:

- **–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞**: http://localhost:8000/
- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

#### –î–æ—Å—Ç—É–ø–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
curl http://localhost:8000/health

# –ü–æ–ª–Ω—ã–π —Å—Ç–∞—Ç—É—Å
curl http://localhost:8000/status

# –ú–µ—Ç—Ä–∏–∫–∏
curl http://localhost:8000/status/metrics

# –°—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–∏
curl http://localhost:8000/status/queue

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (start/stop/pause/resume/restart)
curl -X POST http://localhost:8000/control \
  -H "Content-Type: application/json" \
  -d '{"action": "pause"}'
```

### Python API

```python
import asyncio
from src.core.application import AudioProcessingApplication

async def main():
    app = AudioProcessingApplication()
    
    # –ó–∞–ø—É—Å–∫
    await app.start()
    
    # –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å
    status = await app.get_status()
    print(status)
    
    # –ü–∞—É–∑–∞
    await app.pause()
    
    # –í–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    await app.resume()
    
    # –û—Å—Ç–∞–Ω–æ–≤–∫–∞
    await app.stop()

if __name__ == "__main__":
    asyncio.run(main())
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ `.env` —Ñ–∞–π–ª:

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `MAX_CONCURRENT_TASKS` | 3 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ async –∑–∞–¥–∞—á |
| `MAX_TRANSCRIPTION_CALLS` | 3 | –õ–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ |
| `TASK_QUEUE_MAX_SIZE` | 100 | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ |
| `TRANSCRIPTION_TIMEOUT` | 300 | –¢–∞–π–º–∞—É—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ (—Å–µ–∫) |
| `LOG_LEVEL` | INFO | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è |

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å–º. –≤ `.env.example`

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –†–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏
- –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `structlog`:

```python
# –õ–æ–≥–∏ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ
{"event": "task.processing.file", "file": "audio.wav", "task_id": 1, "timestamp": "2025-10-27T08:30:00"}
```

–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `logs/application.log`

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
pytest

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest --cov=src --cov-report=html

# –û—Ç–∫—Ä—ã—Ç—å –æ—Ç—á–µ—Ç
open htmlcov/index.html
```

## üê≥ Docker

```bash
# –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
docker build -t audio-processing:latest .

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker run -d \
  -p 8000:8000 \
  -v $(pwd)/storage:/app/storage \
  -v $(pwd)/.env:/app/.env \
  --name audio-processing \
  audio-processing:latest
```

## üîç Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: ImportError –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

```bash
# –†–µ—à–µ–Ω–∏–µ: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞–∫ –ø–∞–∫–µ—Ç
pip install -e .
```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—á–µ—Ä–µ–¥—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞

```bash
# –£–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ –≤ .env
TASK_QUEUE_MAX_SIZE=200
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

```bash
# –£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á
MAX_CONCURRENT_TASKS=5
MAX_TRANSCRIPTION_CALLS=5
```
